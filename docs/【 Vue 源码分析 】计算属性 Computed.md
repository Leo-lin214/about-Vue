## å…ˆç†è§£è®¡ç®—å±æ€§

ä¸€æåŠåˆ° Vue çš„è®¡ç®—å±æ€§ï¼Œæƒ³å¿…å¤§å®¶éƒ½ä¼šæƒ³åˆ°å…¶æœ€å¤§çš„ä¼˜ç‚¹â€”â€”**ç¼“å­˜**ã€‚å®˜æ–¹æ–‡æ¡£ä¹Ÿæœ‰æåˆ°

> å¯¹äºä»»ä½•å¤æ‚é€»è¾‘ï¼Œä½ éƒ½åº”å½“ä½¿ç”¨**è®¡ç®—å±æ€§**ã€‚

å¦‚ä½•ç†è§£ï¼Ÿä¸æ˜¯å¯ä»¥ç›´æ¥ä½¿ç”¨æ–¹æ³•å¤„ç†å—ï¼Ÿè¯ä¸å¤šè¯´ï¼Œç›´æ¥çœ‹ä¸€ä¸ªæ —å­ ğŸŒ° ï¼š

```javascript
// html
<div>
  <span>{{ allName }}</span>
	<span>{{ setAllName() }}</span>
	<span>{{ tag }}</span>
</div>

// js
const app = new Vue({
  data: {
    firstName: 'haha',
    lastName: 'hehe',
    tag: false
  },
  computed: {
    allName() {
      return firstName + ' ' + lastName
    }
  },
  methods: {
    setAllName() {
      return firstName + ' ' + lastName
    }
  }
})
```

ç›¸ä¿¡å¾ˆå¤šåŒå­¦å¯¹äºä¸Šè¿°çš„ä»£ç å¹¶ä¸é™Œç”Ÿï¼Œåœ¨ç•Œé¢ä¸Šå±•ç¤ºæ—¶ï¼Œ`allName`å’Œ`setAllName()`æ˜¾ç¤ºçš„æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚é‚£çœŸçš„å°±æ˜¯æ²¡æœ‰ä»»ä½•åŒºåˆ«äº†å—ï¼Ÿ

å…¶å®ä¸æ˜¯çš„ï¼Œå½“æˆ‘æŠŠå˜é‡`tag`çš„å€¼è®¾ä¸º true æ—¶ï¼Œè™½ç„¶å±•ç¤ºçš„æ•ˆæœä¸€æ ·ï¼Œä½†æ˜¯ä¸¤è€…èƒŒåæ¸²æŸ“åŸç†å®Œå…¨ä¸åŒã€‚å…¶ä¸­å°±æ˜¯ä¸Šé¢æåˆ°çš„ç¼“å­˜åŠŸèƒ½ã€‚

ä¸ºä½•è¿™ä¹ˆè¯´ï¼Ÿä½ åªè¦è®°ä½ä¸€ç‚¹ï¼Œ**è®¡ç®—å±æ€§æ˜¯åŸºäºå®ƒä»¬çš„å“åº”å¼ä¾èµ–è¿›è¡Œç¼“å­˜çš„**ã€‚å› æ­¤ï¼Œå½“æŠŠå˜é‡`tag`çš„å€¼è®¾ä¸º true æ—¶ï¼Œç•Œé¢ä¼šé‡æ–°æ¸²æŸ“ï¼Œç”±äºè®¡ç®—å±æ€§`allName`æ˜¯åŸºäºå˜é‡ firstName å’Œ lastName çš„ï¼Œè€Œè¿™ä¸¤è€…å¹¶æ²¡æœ‰å˜åŒ–ï¼Œæ‰€ä»¥ä¼šç›´æ¥è¿”å›æ­¤å‰ä¿å­˜çš„è®¡ç®—å€¼å›æ¥ã€‚ç›¸åï¼Œæ–¹æ³•åˆ™ä¸å¤§ä¸€æ ·äº†ï¼Œå› ä¸ºé‡æ–°æ¸²æŸ“æ—¶ï¼Œæ¨¡æ¿è§£æ`setAllName`æ–¹æ³•æ—¶ï¼Œæ˜¯æ— æ³•è¾¨åˆ«å…¶æœ‰æ²¡æœ‰ä½¿ç”¨è¿‡è¯¥æ–¹æ³•çš„ï¼Œæ‰€ä»¥åˆä¼šé‡æ–°è®¡ç®—ä¸€éå¹¶è¿”å›å€¼å›æ¥ã€‚æœ€ç»ˆ**åœ¨å¤„ç†æ•ˆç‡ä¸Šï¼Œè®¡ç®—å±æ€§æ˜¯å®Œèƒœæ–¹æ³•å¤„ç†çš„**ã€‚

å¦ä¸€æ–¹é¢ï¼Œæ—¢ç„¶è®¡ç®—å±æ€§æ˜¯åŸºäºå“åº”å¼ä¾èµ–è¿›è¡Œè®¡ç®—ä¸å¦çš„ï¼Œé‚£ä¹ˆå®ƒä¹Ÿå¯ä»¥å¾ˆå¥½æ»´å–ä»£æ‰ Watch ä¾¦å¬ã€‚ä»€ä¹ˆæ„æ€ï¼Ÿ

å¦‚æœä½ ä»¥å‰ç”¨è¿‡ Angular çš„è¯ï¼Œç›¸ä¿¡ä½ ä¼šæœ‰ä¸€ä¸ªå¾ˆå¤§çš„ä½“ä¼šï¼Œé‚£å°±æ˜¯æœ€å–œæ¬¢æ»¥ç”¨ watch æ¥ç›‘å¬æŸä¸ªå±æ€§æ˜¯å¦å˜åŒ–ï¼Œç„¶åæ¥è¿›è¡Œç›¸åº”çš„å¤„ç†ï¼Œé‚£ä¹ˆä½¿ç”¨è®¡ç®—å±æ€§çš„å‡ºç°å°±å¾ˆå¥½æ»´é¿å…äº†æ»¥ç”¨ watch è¡Œä¸ºï¼Œè®©ä»£ç åœ¨åæœŸçš„ç»´æŠ¤å’Œç†è§£ä¸Šéƒ½ä¼šæœ‰ä¸€ä¸ªè´¨çš„æå‡ã€‚å®˜æ–¹æ–‡æ¡£ä¸­ä¹Ÿæœ‰æåˆ°

> é€šå¸¸æ›´å¥½çš„åšæ³•æ˜¯ä½¿ç”¨è®¡ç®—å±æ€§è€Œä¸æ˜¯å‘½ä»¤å¼çš„ `watch` å›è°ƒã€‚

åœ¨è¿™é‡Œï¼ŒçœŸçš„ç”±ä¸å¾—æ„Ÿå¹ä¸€ä¸‹ï¼Œå°¤å¤§å¤§å¯ä»¥å‘æ˜å‡ºè®¡ç®—å±æ€§å‡ºæ¥ã€‚ğŸ‘ğŸ½

æ—¢ç„¶ä¸Šé¢éƒ½è¯´åˆ°è®¡ç®—å±æ€§æœ‰é‚£ä¹ˆç‰›ï¼Œé‚£ç©¶ç«Ÿå®ƒæ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥ä»ä¸¤æ–¹é¢è¿›è¡Œå…¥æ‰‹ï¼Œåˆ†åˆ«æ˜¯ï¼š

- è®¡ç®—å±æ€§æ˜¯å¦‚ä½•è¿›è¡Œè®¡ç®—çš„ï¼Ÿ
- è®¡ç®—å±æ€§æ˜¯å¦‚ä½•è¿›è¡Œç¼“å­˜çš„ï¼Ÿ



## ä»æºç è§’åº¦è¿›è¡Œåˆ†æ

è®©æˆ‘ä»¬å…ˆä»åˆå§‹åŒ–é˜¶æ®µæ˜¯å¦‚ä½•å¤„ç†è®¡ç®—å±æ€§çš„ï¼Œä¸Šæºç 

```javascript
var computedWatcherOptions = { lazy: true }; // å…³é”®ä¸­çš„å…³é”®ï¼Œç”¨äºç¼“å­˜ä½œç”¨çš„

function initState (vm) {
  // ...
  if (opts.computed) { initComputed(vm, opts.computed); } // å…ˆåˆ¤æ–­æ˜¯å¦å·²å®šä¹‰è®¡ç®—å±æ€§ï¼Œè‹¥æœ‰åˆ™ç›´æ¥åˆå§‹åŒ–è®¡ç®—å±æ€§
}

function initComputed (vm, computed) {
  var watchers = vm._computedWatchers = Object.create(null); // åˆ›å»ºä¸€ä¸ªçº¯å¯¹è±¡ï¼Œæ–°å»ºä¾èµ–æ‰€ç”¨
  // ...
  for (var key in computed) {
    var userDef = computed[key]; // è·å–å½“å‰ç”¨æˆ·å®šä¹‰çš„è®¡ç®—å±æ€§
    var getter = typeof userDef === 'function' ? userDef : userDef.get; // åˆ¤æ–­å½“å‰å®šä¹‰çš„è®¡ç®—å±æ€§æ˜¯å¦ä¸ºå‡½æ•°ï¼Œè‹¥ä¸æ˜¯åˆ™ç›´æ¥è·å–å…¶ Getter
    if (getter == null) { // ä¸€æ—¦ getter ä¸æ˜¯å‡½æ•°æ—¶ï¼Œå°±ç»™å‡ºè­¦å‘Šï¼ˆè•´å«ç€çŸ¥è¯†ç‚¹ï¼Œundefined == nullï¼‰
      warn(
        ("Getter is missing for computed property \"" + key + "\"."),
        vm
      );
    }
    if (!isSSR) { // ä¸æ˜¯æœåŠ¡ç«¯æ¸²æŸ“æ—¶ï¼Œå°±ç›´æ¥ä¸ºæ¯ä¸ªè®¡ç®—å±æ€§åˆ›å»ºä¸€ä¸ªç›¸å…³ä¾èµ–
      // create internal watcher for the computed property.
      watchers[key] = new Watcher(
        vm,
        getter || noop,
        noop,
        computedWatcherOptions // å…³é”®ä¸­çš„å…³é”®ï¼Œç”¨äºç¼“å­˜ä½œç”¨çš„
      );
    }
    if (!(key in vm)) { // åˆ¤æ–­æ˜¯å¦ä¸ºæ–°åˆ›å»ºçš„è®¡ç®—å±æ€§
      defineComputed(vm, key, userDef);	// å…³é”®å‡½æ•°ï¼Œä¸»è¦è´Ÿè´£è®¡ç®—å±æ€§å“åº”å¼å¤„ç†
    } 
  }
}
```

ç†è§£è¿™æ®µä»£ç å¹¶ä¸éš¾ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªçŸ¥è¯†ç‚¹ï¼š

- ä½¿ç”¨`Object.create(null)`åˆ›å»ºä¸€ä¸ªçº¯å¯¹è±¡ï¼ˆç›¸å…³é“¾æ¥ï¼Œå¯çœ‹å…¶ä»–è¯é¢˜ä¸­[Object.create(null) ä¸ {} ç©¶ç«Ÿæœ‰ä»€ä¹ˆä¸ä¸€æ ·](https://github.com/Andraw-lin/about-Vue/blob/master/docs/%E3%80%90%20Vue%20%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%20%E3%80%91%E8%AE%A1%E7%AE%97%E5%B1%9E%E6%80%A7%20Computed.md)ï¼‰
- åˆ¤æ–­è®¡ç®—å±æ€§å®šä¹‰æ—¶çš„ç±»å‹
- ä¸ºæ¯ä¸ªè®¡ç®—å±æ€§åˆ›å»ºå„è‡ªçš„ä¾èµ–
- æ–°å®šä¹‰çš„è®¡ç®—å±æ€§ï¼Œä½¿ç”¨`defineComputed`æ–¹æ³•è¿›è¡Œå“åº”å¼å¤„ç†

å¯ä»¥çœ‹åˆ°ï¼Œæ¯ä¸ªè®¡ç®—å±æ€§æœ¬èº«å°±ä¼šè¢«ä½œä¸ºä¸€ä¸ª Watcher ä¾èµ–ï¼Œç°åœ¨å°±æ¥çœ‹çœ‹`defineComputed`æ–¹æ³•æ˜¯å¦‚ä½•è¿›è¡Œå“åº”å¼å¤„ç†çš„

```javascript
var sharedPropertyDefinition = {
  enumerable: true,
  configurable: true,
  get: noop,
  set: noop
};

function defineComputed (
	target,
 	key,
 	userDef
) {
    var shouldCache = !isServerRendering(); // æ˜¯å¦ä¸ºæœåŠ¡ç«¯æ¸²æŸ“
    if (typeof userDef === 'function') { // é’ˆå¯¹è®¡ç®—å±æ€§ç›´æ¥å®šä¹‰ä¸ºå‡½æ•°çš„å½¢å¼
      sharedPropertyDefinition.get = shouldCache
        ? createComputedGetter(key) // å…³é”®å‡½æ•°ï¼Œä¸»è¦è´Ÿè´£è®¡ç®—å±æ€§çš„ç¼“å­˜ä»¥åŠä¸ $data å»ºç«‹ä¾èµ–æ”¶é›†
        : createGetterInvoker(userDef);
      sharedPropertyDefinition.set = noop;
    } else { // ä¸€æ—¦å®šä¹‰çš„ä¸æ˜¯å‡½æ•°ç±»å‹ï¼Œåˆ™ç›´æ¥ä» Getter é‡Œé¢å»æ‹¿
      sharedPropertyDefinition.get = userDef.get
        ? shouldCache && userDef.cache !== false
          ? createComputedGetter(key) // å…³é”®å‡½æ•°ï¼Œä¸»è¦è´Ÿè´£è®¡ç®—å±æ€§çš„ç¼“å­˜ä»¥åŠä¸ $data å»ºç«‹ä¾èµ–æ”¶é›†
          : createGetterInvoker(userDef.get)
        : noop;
      sharedPropertyDefinition.set = userDef.set || noop;
    }
    if (sharedPropertyDefinition.set === noop) { // åŒæ—¶é’ˆå¯¹ Setter æœªè®¾ç½®ï¼Œé»˜è®¤é…ç½®ä¸€ä¸ªè­¦å‘Šå‡½æ•°
      sharedPropertyDefinition.set = function () {
        warn(
          ("Computed property \"" + key + "\" was assigned to but it has no setter."),
          this
        );
      };
    }
    Object.defineProperty(target, key, sharedPropertyDefinition); // è¿›è¡Œå“åº”å¼çš„å¤„ç†
  }
```

ç”±æ­¤å¯ä»¥çœ‹åˆ°ï¼Œæ¯ä¸ªè®¡ç®—å±æ€§é™¤äº†è¢«å®šä¹‰ä¸º Watcher å¤–ï¼Œè¿˜ä¼šä½œä¸€ä¸ªå“åº”å¼å¤„ç†ã€‚ä¾¿äºå»ºç«‹ä¸é¡µé¢è°ƒç”¨æ—¶çš„ä¾èµ–ï¼Œä¸€æ—¦é¡µé¢æ›´æ–°åï¼ŒåŒæ—¶åˆ¤æ–­æ˜¯å¦éœ€è¦é‡æ–°è®¡ç®—ï¼Œç”±äºè®¡ç®—å±æ€§æ‹¥æœ‰ç€å¼ºå¤§çš„ç¼“å­˜åŠŸèƒ½ï¼Œå› æ­¤è‹¥ä¾èµ–çš„å“åº”å¼å±æ€§ data æ²¡æœ‰å˜åŒ–æ—¶ï¼Œåˆ™ä¼šç›´æ¥è¿”å›åŸæ¥è®¡ç®—çš„å€¼ï¼Œé¿å…é‡æ–°è®¡ç®—ã€‚

æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹çœ‹æ–¹æ³•`createComputedGetter`æ˜¯å¦‚ä½•å¤„ç†ç¼“å­˜ä»¥åŠä¸ $data å»ºç«‹ä¾èµ–æ”¶é›†çš„

```javascript
function createComputedGetter (key) {
  return function computedGetter () {
    var watcher = this._computedWatchers && this._computedWatchers[key]; // æ‹¿åˆ°æ¯ä¸€ä¸ªè®¡ç®—å±æ€§å·²ç»å®šä¹‰å¥½çš„ Watcher
    if (watcher) {
      if (watcher.dirty) { // ç¼“å­˜çš„å…³é”®ï¼Œåªæœ‰ dirty ä¸º true æ—¶æ‰ä¼šè¿›è¡Œé‡æ–°è®¡ç®—ï¼Œå¦åˆ™ç›´æ¥è·å–å·²ç»è®¡ç®—å¥½çš„å€¼
        watcher.evaluate();
      }
      if (Dep.target) { // å»ºç«‹ä¾èµ–çš„å…³é”®ï¼Œå»ºç«‹ä¸é¡µé¢ä¹‹é—´çš„ä¾èµ–
        watcher.depend();
      }
      return watcher.value
    }
  }
}
```

ä¹Ÿè®¸æœ‰åŒå­¦ä¼šæœ‰ç–‘æƒ‘ï¼Œç©¶ç«Ÿ dirty æ˜¯ä»€ä¹ˆï¼Ÿä»¥åŠ Dep.target åˆæ˜¯å•¥ï¼Ÿ

æˆ‘ä»¬å…ˆæ¥é‡æ–°å›é¡¾ä¸€ä¸‹è®¡ç®—å±æ€§åœ¨åˆ›å»º Watcher æ—¶æ˜¯å¦‚ä½•ä¼ é€’å€¼çš„ï¼Œä»¥åŠ Wacther ç±»ä¸­æ˜¯å¦‚ä½•å¤„ç†çš„ã€‚

```javascript
// ...
// create internal watcher for the computed property.
watchers[key] = new Watcher(
	vm,
  getter || noop,
  noop,
  computedWatcherOptions // å…³é”®ä¸­çš„å…³é”®ï¼Œç”¨äºç¼“å­˜ä½œç”¨çš„
);
// ...
var Watcher = function Watcher (
	vm,
 	expOrFn, // æ›´æ–°å›è°ƒå‡½æ•°
 	cb,
 	options, // é€‰é¡¹é…ç½®
 	isRenderWatcher
) {
    // ...
    if (options) {
 			// ...
      this.lazy = !!options.lazy;
      // ...
    }
    // ...
    this.dirty = this.lazy;
  }
```

è®¡ç®—å±æ€§åœ¨åˆ›å»º Watcher ä¾èµ–æ—¶ï¼Œä¼šä¼ é€’ä¸€ä¸ª lazy ä¸º true çš„å±æ€§ï¼Œè¯¥å±æ€§ä¸æ˜¯æ‡’æƒ°çš„æ„æ€ï¼Œå¯ä»¥ç†è§£æˆç¼“æ…¢å˜åŒ–çš„æ„æ€å³ä¸å˜ã€‚å°† lazy ç›´æ¥èµ‹äºˆåˆ° Watcher çš„ dirty å±æ€§ä¸­ï¼ˆè‡³äº dirty ï¼Œå¯ä»¥ç†è§£ä¸ºæ˜¯å¦ä¸ºè„æ•°æ®ï¼‰ã€‚å› æ­¤ä¸€å¼€å§‹ï¼Œè®¡ç®—å±æ€§åœ¨é¡µé¢ä¸­éƒ½ä¼šè¢«è®¡ç®—ä¸€éã€‚å¦ä¸€æ–¹é¢ï¼Œç”±äºä¼šæŠŠè®¡ç®—å±æ€§çš„ Getter å‡½æ•°ä¼ å…¥åˆ° Wacther ä½œä¸ºæ›´æ–°å›è°ƒå‡½æ•°ä½¿ç”¨ï¼Œä¸€æ—¦ä¾èµ–çš„å“åº”å¼å±æ€§å˜åŒ–æ—¶ï¼Œå°±ä¼šè°ƒç”¨æ›´æ–°å›è°ƒå‡½æ•°è¿›è¡Œé‡æ–°è®¡ç®—è®¡ç®—å±æ€§çš„å€¼ã€‚

å½“é¡µé¢ç¬¬ä¸€æ¬¡å¼•ç”¨äº†è®¡ç®—å±æ€§æ—¶ï¼Œdirty çš„å€¼è‚¯å®šä¼šä¸º true ï¼Œå°±ä¼šè°ƒç”¨ Watcher çš„ evaluate æ–¹æ³•ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ evaluate æ–¹æ³•

```javascript
/**
 * Evaluate the value of the watcher.
 * This only gets called for lazy watchers.
 */
Watcher.prototype.evaluate = function evaluate () {
  this.value = this.get();
  this.dirty = false;
};

/**
 * Evaluate the getter, and re-collect dependencies.
 */
Watcher.prototype.get = function get () {
  pushTarget(this);
  var value;
  var vm = this.vm;
  try { 
    value = this.getter.call(vm, vm); // å¼•ç”¨å“åº”å¼å±æ€§ï¼Œå»ºç«‹ä¸å“åº”å¼å±æ€§ä¹‹é—´çš„ä¾èµ–
  // ...
  } finally {
    // ...
    popTarget();
    // ...
  }
  return value
};
```

å¥½æ˜æ˜¾ï¼Œevaluate æ–¹æ³•å°±æ˜¯å¼€å§‹è®¡ç®—è®¡ç®—å±æ€§çš„å€¼ï¼Œç„¶åå†è®¾ç½®å…¶ dirty å±æ€§ä¸º falseï¼Œè¿™æ—¶å€™å°±ä¼šè¢«è®¤ä¸ºæ˜¯å·²ç»æ›´æ–°çš„å€¼äº†ï¼Œä¸‹ä¸€æ¬¡åœ¨è°ƒç”¨æ—¶å°±ä¸ä¼šè¿›è¡Œé‡æ–°è®¡ç®—ã€‚å¦ä¸€æ–¹é¢ï¼Œç”±äºåœ¨è°ƒç”¨ this.getter å‡½æ•°ï¼ˆå³æ›´æ–°å›è°ƒå‡½æ•°ï¼‰æ—¶ï¼Œä¼šå¼•ç”¨å“åº”å¼å±æ€§å¹¶åœ¨å“åº”å¼å±æ€§ä¸­æ”¶é›†åˆ°è®¡ç®—å±æ€§çš„ä¾èµ–ã€‚

é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œä»€ä¹ˆæ—¶å€™ dirty æ‰ä¼šè¢«è®¾å› true ï¼Ÿè¿˜æœ‰å°±æ˜¯ä¸ºä»€ä¹ˆå¼•ç”¨å“åº”å¼å±æ€§å°±ä¼šåœ¨å“åº”å¼å±æ€§ä¸­æ”¶é›†åˆ°è®¡ç®—å±æ€§çš„ä¾èµ–ï¼Ÿç°åœ¨æˆ‘æ¥ç®€å•è§£æä¸€ä¸‹ï¼š

- ä»€ä¹ˆæ—¶å€™ dirty æ‰ä¼šè¢«è®¾å› true ï¼Ÿ

  è®¡ç®—å±æ€§çš„ Watcher åªä¼šè¢«æ”¶é›†åˆ°ç›¸å¯¹åº”çš„å“åº”å¼å±æ€§ä¸­ï¼Œå› æ­¤åœ¨å“åº”å¼å±æ€§æ›´æ”¹åï¼Œé€šçŸ¥åˆ°ç›¸å¯¹åº”çš„ Watcher è¿›è¡Œæ›´æ–°ï¼Œå…¶å®å°±ä¼šåœ¨ update å‡½æ•°ä¸­è¿›è¡Œè®¾ç½® dirty ä¸º falseï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹

  ```javascript
  /**
   * Subscriber interface.
   * Will be called when a dependency changes.
   */
  Watcher.prototype.update = function update () {
    /* istanbul ignore else */
    if (this.lazy) {
      this.dirty = true;
    }
    // ...
  };
  ```

  å¯ä»¥çœ‹åˆ°ï¼Œç”±äºè®¡ç®—å±æ€§çš„ lazy ä¼š trueï¼Œå› æ­¤åœ¨å“åº”å¼å±æ€§æ›´æ–°æ—¶ï¼Œä½ æœ‰æ²¡æœ‰å‘ç°ä»…ä»…åªæ˜¯æŠŠ dirty è®¾å›ä¸º true ï¼Œå¹¶æ²¡æœ‰è°ƒç”¨æ›´æ–°å›è°ƒå‡½æ•°ï¼Ÿ

  è¿™ä¹Ÿæ˜¯ä¸€ä¸ª**ä¼˜åŒ–ç‚¹**ï¼Œå°±æ˜¯**è¦ç­‰åˆ°é¡µé¢è°ƒç”¨çš„åœ°æ–¹æ›´æ–°æ—¶ï¼Œæ‰ä¼šé€šçŸ¥è®¡ç®—å±æ€§é‡æ–°è®¡ç®—å€¼**ï¼ˆç±»ä¼¼äºæˆ‘ä»¬çš„æŒ‰éœ€å¼•å…¥ä¸€æ ·ï¼‰ã€‚

- ä¸ºä»€ä¹ˆå¼•ç”¨å“åº”å¼å±æ€§å°±ä¼šåœ¨å“åº”å¼å±æ€§ä¸­æ”¶é›†åˆ°è®¡ç®—å±æ€§çš„ä¾èµ–ï¼Ÿ

  ç›¸ä¿¡çœ‹åˆ°æˆ‘ä¹‹å‰çš„æ–‡ç« ï¼Œåº”è¯¥éƒ½çŸ¥é“ï¼Œå“åº”å¼å±æ€§éƒ½ä¼šè®¾ç½® Getter å’Œ Setter ï¼Œå› æ­¤å½“è®¡ç®—å±æ€§è®¡ç®—å€¼æ—¶ï¼Œä¼šå¼•ç”¨åˆ°å“åº”å¼å±æ€§ï¼Œè¿™æ ·æœºä¼šå°†è®¡ç®—å±æ€§çš„ Watcher æ”¶é›†åˆ°äº†å“åº”å¼å±æ€§ä¸­ã€‚



å¥½äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å†çœ‹çœ‹å¦‚ä¸‹ä»£ç ï¼Œç©¶ç«Ÿæ˜¯ä»€ä¹ˆç”¨å‘¢ï¼Ÿ

```javascript
// ...
if (Dep.target) { // å»ºç«‹ä¾èµ–çš„å…³é”®ï¼Œå»ºç«‹å“åº”å¼å±æ€§ä¸é¡µé¢ä¹‹é—´çš„ä¾èµ–
  watcher.depend();
}
// ...
```

å‰é¢å¯ä»¥çœ‹åˆ°ï¼Œå½“å°†è®¡ç®—å±æ€§è¢«æ”¶é›†åˆ°å“åº”å¼å±æ€§ä¸­åï¼Œä¼šè°ƒç”¨`popTarget`æ–¹æ³•å°†`Dep.target`é‡æ–°æŒ‡å›åˆ°é¡µé¢çš„ Watcherï¼Œè¿™æ—¶å€™è°ƒç”¨

`watcher.depend()`åå°±ä¼šå°†é¡µé¢çš„ Watcher æ”¶é›†åˆ°äº†å“åº”å¼å±æ€§ä¸­ã€‚è¿™ä¹Ÿå°±è¯´æ˜ï¼Œå½“é¡µé¢è°ƒç”¨è®¡ç®—å±æ€§æ—¶ï¼Œå“åº”å¼æ›´æ”¹åï¼Œè®¾ç½®è®¡ç®—å±æ€§çš„ dirty ä¸º true åï¼Œå¹¶ä¸æ˜¯ç”±è®¡ç®—å±æ€§å»é€šçŸ¥é¡µé¢æ›´æ–°çš„ï¼Œè€Œæ˜¯ä»¥è®©æœ‰å“åº”å¼å±æ€§é€šçŸ¥é¡µé¢æ›´æ–°åï¼Œå†å»é‡æ–°è®¡ç®—è®¡ç®—å±æ€§çš„å€¼ã€‚

çœ‹åˆ°è¿™é‡Œï¼Œæ˜¯å¦ä¼šè¿·æƒ‘äº†ï¼ŸğŸ˜„ å…¶å®å°¤å¤§å¤§æ˜¯çœŸçš„å¾ˆå‰å®³ï¼Œåˆ©ç”¨ä¸€ä¸ªæ ‡è®°ä½æ¥å®ç°è®¡ç®—å±æ€§çš„ç¼“å­˜åŠŸèƒ½ï¼Œè€Œä¸”åªæœ‰åœ¨è°ƒç”¨åˆ°å…¶è®¡ç®—å±æ€§æ—¶æ‰å»å¼€å§‹è®¡ç®—å…¶å€¼ï¼Œå®ç°äº†ä¸€ä¸ªæŒ‰éœ€è°ƒç”¨çš„æ€æƒ³ã€‚

æˆ‘ä»¬ç°åœ¨æ¥æ€»ç»“ä¸€ä¸‹ï¼š

- å®šä¹‰è®¡ç®—å±æ€§æ—¶ï¼Œä¼šä¾æ¬¡ä¸ºæ¯ä¸€ä¸ªè®¡ç®—å±æ€§åˆ›å»ºç›¸åº”çš„ Watcherï¼Œå¹¶è®¾ç½®æˆå“åº”å¼ï¼›
- å½“æ¨¡æ¿ä¸­å¼•ç”¨åˆ°è®¡ç®—å±æ€§æ—¶ï¼Œä¼šå…ˆå°†è®¡ç®—å±æ€§çš„ Watcher æ”¶é›†åˆ°ç›¸åº”çš„å“åº”å¼å±æ€§ä¸­ï¼Œå¹¶ä¸”è®¡ç®—åˆ°å€¼åä¼šæŠŠ`dirty`ç¼“å­˜æ ‡è®°ä½è®¾ç½®ä¸º falseï¼Œè¿™æ ·ä¸€æ¥ï¼Œä¸‹æ¬¡æ¨¡æ¿æ›´æ–°åï¼Œå‘ç°`dirty`æ ‡è®°ä½ä¸º falseï¼Œå°±ä¸ä¼šé‡æ–°è®¡ç®—ã€‚åŒæ—¶å“åº”å¼å±æ€§ä¼šæ”¶é›†åˆ°æ¨¡æ¿çš„ Watherï¼›
- å½“å“åº”å¼å±æ€§æ›´æ”¹æ—¶ï¼Œä¼šå…ˆè®¾ç½®è®¡ç®—å±æ€§çš„`dirty`ç¼“å­˜æ ‡è®°ä½ä¸º trueï¼Œç„¶åé€šçŸ¥æ¨¡æ¿è¿›è¡Œæ›´æ–°ã€‚æ¨¡æ¿åœ¨æ›´æ–°çš„è¿‡ç¨‹ä¸­å‘ç°è®¡ç®—å±æ€§çš„`dirty`ç¼“å­˜æ ‡è®°ä½ä¸º trueï¼Œè¿™æ—¶å€™å°±ä¼šé‡æ–°è®¡ç®—å…¶å€¼å¹¶è¿”å›ï¼›









































